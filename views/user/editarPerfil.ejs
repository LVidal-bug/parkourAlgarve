<%- layout('layouts/boilerplate') %>
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Antonio:wght@100;400&display=swap" rel="stylesheet">


    <div class=" col-10 cont border mb-5">
        <div class="upperpart1">
            <form action="/user/<%=user._id %>/editProfile?_method=PUT" enctype="multipart/form-data" method="POST">


                <div class="info mb-3">
                    <div class="d-flex ">

                        <div class="mb-3 mr-5">
                            <div class="icon border">
                                <label class="addImage  plusText" for="photo">+</label>
                                <img src="" alt="" class="previewImg">

                            </div>

                            <input class=" hide infoformform-control inpFile" type="file" id="photo" name="image">
                        </div>
                        <div class="userPlace mt-3">
                            <h4 class="d-flex flex-column">
                                <%=user.username %>
                            </h4>
                        </div>

                    </div>
                    <div class="infoplus my-2 ">
                        <div class="divs">
                            <label for="age" class="form-label">Idade:</label>
                            <input class="infoform form-control" type="number" min="0" placeholder="Idade"
                                aria-label="default input example" id="age" name="age" value="<%=user.profile.age %>">
                        </div>
                        <div class="divs ">
                            <label for="experience" class="form-label">Anos de treino:</label>
                            <input class="infoform form-control" type="number" placeholder="Anos de treino"
                                aria-label="default input example" id="experience" name="experience"
                                value="<%=user.profile.experience%>">
                        </div>
                        <div class="divs ">
                            <label for="city" class="form-label">A tua cidade:</label>
                            <input class="infoform form-control" type="text" placeholder="Cidade"
                                aria-label="default input example" id="city" name="city" value="<%=user.profile.city%>">
                        </div>

                    </div>
                    <div class="description">
                        <div class="my-3 textarea ">
                            <label for="description">Adiciona uma descrição</label>
                            <textarea name="description" class=" form-control" id="description" cols="20"
                                rows="7"><%=user.profile.description %></textarea>
                        </div>
                    </div>

                </div>
                <p><button class=" btn btn-info">Editar Perfil</button></p>

            </form>
        </div>
        <% if(user.certificates.length){ %>
            <h5 class="mt-3 ">Certificados:</h5>
            <% for(let c of user.certificates) {%>
                <div class=" mb-3 ">
                    <% if(`${c.author}`===`${currentUser._id}`) {%>
                        <div class="admin ml-3">
                        </div>
                        <link rel="stylesheet" href="/css/files.css">
                </div>
                <% } %>
                    <% } %>
                        <% } %>
                            <a class="preview" href="/user/<%=user._id %>  ">Perfil</a>
    </div>
    <script>
        const parentDiv = document.querySelector(".admin");
        window.addEventListener("load", async () => {
            try {
                let result = await axios({
                    method: "GET",
                    url: "/api/getFiles",
                });
                let files = result.data.files;
                files.forEach((file) => {
                    markup = `
                     <div class="files__entity">
                        <form action="/user/${file.author}/certificates/${file._id}?_method=DELETE" method="POST"><button id="hideBTN"><i class="material-icons ">delete</i></button></form>
                      <i class="files__icon fa fa-file-text" aria-hidden="true"></i>
                     <p> <li ><a href="/user/${file.author}/certificates/${file._id}" class="files__link"><i class="fa fa-eye tests__icon" aria-hidden="true"></i>${file.title}</a></li></p>
                     </div> 
                    `;
                    parentDiv.insertAdjacentHTML("beforeend", markup);
                });
            } catch (error) {
                console.log(error);
            }
        });
    </script>
    <script src="/scripts/file.js"></script>